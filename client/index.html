<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AudioParty - Stream Music Together</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <img src="audioparty_logo.jpg" alt="AudioParty" class="logo">
        </header>

        <!-- Landing Screen -->
        <div id="landing-screen" class="screen active">
            <div class="button-group">
                <button id="host-btn" class="primary-btn">Host a Party</button>
                <button id="join-btn" class="secondary-btn">Join a Party</button>
            </div>
            
            <div id="join-form" class="hidden">
                <input type="text" id="room-code-input" placeholder="Enter room code (e.g., ABC123)" maxlength="6">
                <button id="join-submit-btn" class="primary-btn">Join</button>
                <button id="join-cancel-btn" class="text-btn">Cancel</button>
            </div>

            <div class="info-box">
                <h3>How it works:</h3>
                <ul>
                    <li><strong>Hosts:</strong> Share a browser tab playing music (Spotify, YouTube, etc.)</li>
                    <li><strong>Listeners:</strong> Join with a room code and listen in real-time</li>
                    <li><strong>Private:</strong> Max 10 people per party, no data stored</li>
                </ul>
            </div>

            <button id="troubleshooting-btn" class="text-btn help-btn">Trouble Connecting?</button>

            <div id="troubleshooting-panel" class="info-box hidden">
                <h3>ðŸ”§ Troubleshooting Tips</h3>
                
                <h4>Browser Requirements:</h4>
                <ul>
                    <li><strong>Use Chrome or Edge:</strong> Hosting requires a Chromium-based browser (Chrome, Edge, Brave, Opera)</li>
                    <li><strong>Firefox limitation:</strong> Can listen but cannot host parties</li>
                    <li><strong>Update your browser:</strong> Make sure you're using the latest version</li>
                </ul>

                <h4>Connection Issues:</h4>
                <ul>
                    <li><strong>Disable VPN:</strong> VPNs can block WebRTC connections needed for audio streaming</li>
                    <li><strong>Corporate/School networks:</strong> May block peer-to-peer connections - try on personal network</li>
                    <li><strong>Firewall/Antivirus:</strong> Temporarily disable to test if they're blocking connections</li>
                    <li><strong>Use different network:</strong> Try mobile hotspot if on restricted network</li>
                </ul>

                <h4>Audio Not Playing:</h4>
                <ul>
                    <li><strong>Check volume:</strong> Make sure your system volume and AudioParty volume slider are up</li>
                    <li><strong>Browser permissions:</strong> Ensure you allowed audio when prompted</li>
                    <li><strong>Refresh and retry:</strong> Sometimes a page refresh can resolve connection issues</li>
                </ul>

                <h4>Chrome Tab Switching:</h4>
                <ul>
                    <li><strong>Expected behavior:</strong> Chrome automatically switches to the tab you're sharing</li>
                    <li><strong>Solution:</strong> Just click back to the AudioParty tab after selecting your audio source</li>
                    <li><strong>Tip:</strong> Pin the AudioParty tab or open it in a separate window for easier access</li>
                </ul>

                <button id="close-troubleshooting-btn" class="secondary-btn">Close</button>
            </div>
        </div>

        <!-- Host Screen -->
        <div id="host-screen" class="screen">
            <div class="status-bar">
                <span class="room-code">Room Code: <strong id="host-room-code">------</strong></span>
                <span class="participant-count">ðŸ‘¥ <span id="host-participant-count">1</span>/10</span>
            </div>

            <div id="host-setup" class="setup-panel">
                <h2>Start Your Party</h2>
                <p class="instruction">Click below to share a browser tab with audio (Spotify, YouTube, etc.)</p>
                <button id="start-streaming-btn" class="primary-btn large">Share Audio Tab</button>
                <p class="hint">ðŸ’¡ Make sure to check "Share audio" in the browser dialog</p>
            </div>

            <div id="host-streaming" class="streaming-panel hidden">
                <div class="status-indicator">
                    <span class="pulse"></span>
                    <span>Streaming Audio</span>
                </div>

                <!-- Current Song Display -->
                <div id="current-song-display" class="song-display">
                    <div class="song-info">
                        <div class="song-status">ðŸŽµ Listening for songs...</div>
                    </div>
                </div>
                
                <div class="share-buttons">
                    <button id="copy-code-btn" class="secondary-btn">Copy Code</button>
                    <button id="copy-link-btn" class="secondary-btn">Copy Join Link</button>
                    <button id="share-discord-btn" class="discord-btn">ðŸ“¢ Share on Discord</button>
                </div>

                <button id="stop-streaming-btn" class="danger-btn">End Party</button>
            </div>
        </div>

        <!-- Listener Screen -->
        <div id="listener-screen" class="screen">
            <div class="status-bar">
                <span class="room-code">Room: <strong id="listener-room-code">------</strong></span>
                <span class="participant-count">ðŸ‘¥ <span id="listener-participant-count">-</span>/10</span>
                <span class="connection-status" id="connection-status">Connecting...</span>
            </div>

            <div id="listener-connecting" class="setup-panel">
                <div class="loader"></div>
                <h2>Connecting to party...</h2>
                <p>Please wait while we establish the audio stream</p>
            </div>

            <div id="listener-playing" class="streaming-panel hidden">
                <div class="status-indicator">
                    <span class="pulse"></span>
                    <span>Receiving Audio</span>
                </div>

                <!-- Current Song Display for Listeners -->
                <div id="listener-song-display" class="song-display">
                    <div class="song-info">
                        <div class="song-status">ðŸŽµ Waiting for song info...</div>
                    </div>
                </div>

                <div class="audio-controls">
                    <label for="volume-slider">Volume</label>
                    <input type="range" id="volume-slider" min="0" max="100" value="80">
                    <span id="volume-value">80%</span>
                </div>

                <div class="info-message">
                    <p>ðŸŽ§ Listening to the host's audio stream</p>
                </div>

                <button id="leave-party-btn" class="secondary-btn">Leave Party</button>
            </div>

            <div id="listener-error" class="error-panel hidden">
                <h2>Connection Error</h2>
                <p id="error-message">Unable to connect to the party</p>
                <button id="back-to-home-btn" class="primary-btn">Back to Home</button>
            </div>
        </div>
    </div>

    <!-- Hidden audio element for playback -->
    <audio id="remote-audio" autoplay></audio>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/app.js"></script>
    <script src="js/song-detection.js"></script>
    <script src="js/host.js"></script>
    <script src="js/listener.js"></script>
    <script src="js/webrtc.js"></script>
</body>
</html>
